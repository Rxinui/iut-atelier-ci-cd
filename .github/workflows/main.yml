name: CI/CD pour Atelier 0 # Le nom de la chaine CI/CD (workflow)
# Controle de la chaine CI/CD
on:
  # Lance la chaine CI/CD lorsque un `git push` est effectué sur les branches indiquées
  push:
    branches: [atl0_solution] #TODO A completer
# Les taches (jobs) à effectuer
jobs:
  # Chaque tache (job) est représentée par un serveur, ce qui permet l'indépendance des tâches.
  build-test-deploy: # Le nom de la tache
    runs-on: ubuntu-latest # Choix de l'OS du serveur pour l'étape 'build'
    steps:
      - name: "[CI] Build l'environnement en récupérant le repo entier de votre branche."
        uses: actions/checkout@v2 # Ne pas toucher
      - name: "[DEBUG] Lister l'arborescence de fichiers sur le serveur"
        run: ls -l . # étape informative
      - name: "[CI] Test du code"
        run: cd atelier/ && ./test.sh
      - name: "[CD] Publication du code"
        # Regle le pb natif de l'action utilisé qui s'executait malgré que le test précédent eu été en erreur. 
        # On force l'execution de cette tache quand toutes les précédentes sont validées
        if: ${{ success() }} 
        uses: nwtgck/actions-netlify@v1.2
        with:
          publish-dir: "./atelier"
          production-branch: atl0_solution
        env:
          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}
        
